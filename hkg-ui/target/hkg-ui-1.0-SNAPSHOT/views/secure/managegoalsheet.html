<div class="row" ng-init="initData()">
    <div class="col-xs-12"> 
        <div class="col-xs-12 breadcrumb-bg" ng-if="!configureWorkFlow">
            <div class="col-xs-12 col-lg-8">
                <ol class="breadcrumb">
                    <li>{{entity + 'You are here'| translate }}</li>
                    <li>{{entity + 'Manage'| translate }}</li>
                    <li class="active">{{entity + 'Manage Goal Sheet'| translate }}</li>
                </ol>
            </div>
            <div ng-show="flag !== 'show_verify'" class="col-xs-12 col-lg-4 text-right context-menu"> 
                <span class="glyphicon glyphicon-search text-primary"></span>&nbsp;
                <a href=""  ng-click="verifyGoalSheetClick();">{{entity + 'Verify goal sheet'| translate }}</a>
            </div>
        </div>
        <div class="col-xs-12 new-panel">
            <div class="row">
                <div class="col-md-12">
                    <div id="messages" ng-include src="'templates/messages.html'"></div>
                </div>
            </div>
            <form role="form" class="form-horizontal" novalidate name="goalForm" ng-show="flag === 'show_submit'">
                <div class="row">
                    <div class="col-md-4">
                        <h4>{{entity + "Goal Sheet" | translate}}</h4>
                    </div>
                    <div class="col-md-2">&nbsp;</div>
                    
                </div>
                <div class="row" ng-if="canAccess('goalsheetAccess')">
                    <div class="col-md-6 pull-left" >
                        <div class="col-md-4 pull-left"><span>{{entity + "Access goal sheet of " | translate}}</span></div>
                        <div class="col-md-2">
                            <label><input type="radio" name="goalSheetType" ng-change="radioChange()" id="goalSheetType" ng-model="typeOfUser" value="myGoalSheet"/>{{entity + " mine" | translate}}</label>
                        </div>
                        <div class="col-md-5">
                            <input class="col-md-1" type="radio" name="goalSheetType" id="goalSheetType1" ng-model="typeOfUser" value="otherGoalSheet"/>
                            <select ng-change="initData(flag1.userId)" ng-disabled="typeOfUser === 'myGoalSheet'" class="col-md-11 hkg-nopadding input-sm" ui-select2="{allowClear:true}" ng-model="flag1.userId" id="selectUser" name="selectUser" data-placeholder="{{ entity + 'Select user' | translate}}">
                                <option value=""></option>
                                <option ng-repeat="user in userList" value="{{user.otherId}}" title="{{user.label}}">{{user.label.length > 41 ? user.label.substring(0, 41) + '...' : user.label}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12">&nbsp;</div>
                </div>
                <div class="row" ng-show="!goalSheetMap['empty']" ng-repeat="(key, value) in goalSheetMap" >
                    <div class="col-md-3">{{entity + "For: "+key | translate}}</div>
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th class="text text-center col-md-3">{{entity + "Goal" | translate}}</th>
                                <th class="text text-center col-md-2">{{entity + "Submit By" | translate}}</th>
                                <th class="text text-center col-md-3" ng-if="!!value[0].activityNode">{{entity + "Target" | translate}}</th>
                                <th class="text text-center col-md-2">{{entity + "Achieved" | translate}}</th>
                                <th class="text text-center col-md-2">{{entity + "" | translate}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="val in value| orderBy:'toDate':false" ng-form="goalSheetForm">
                                <td class="text text-center col-md-3">{{entity + val.goalName | translate}}</td>
                                <td class="text text-center col-md-2">{{entity + val.toDate | translate | date}}</td>
                                <td class="text text-center col-md-3" ng-if="!!value[0].activityNode">
                                    <div ng-class="{'has-error': ((goalSheetForm.target.$dirty || val.submitted) && !val.validTarget)}">
                                        <input ng-required="!!value[0].activityNode" type="text" id="target" name="target" class="form-control" numbers-only ng-change="validateTarget(val)" ng-blur="validateTarget(val)" ng-model="val.target" ng-bind="entity + val.target | translate"/>
                                        <div class="error,help-block" ng-show="((goalSheetForm.target.$dirty || val.submitted) && !val.validTarget)">
                                            <span class="help-block" ng-if="!!val.minTarget && !!val.maxTarget">{{ entity + 'Enter target between '+val.minTarget+' and '+val.maxTarget | translate }}</span>
                                            <span class="help-block" ng-if="!!val.minTarget && !!!val.maxTarget">{{ entity + 'Enter target greater than or equal to '+val.minTarget | translate }}</span>
                                            <span class="help-block" ng-if="!!!val.minTarget && !!val.maxTarget">{{ entity + 'Enter target less than or equal to '+val.maxTarget | translate }}</span>
                                            <span class="help-block" ng-if="!!!val.minTarget && !!!val.maxTarget">{{ entity + 'Enter valid target ' | translate }}</span>
                                        </div>                   
                                    </div>
                                </td>
                                <td class="text text-center col-md-2"><input type="checkbox" ng-model="val.goalAchieved"/></td>
                                <td class="text text-center col-md-2"><button class="btn btn-hkg" ng-click="submitGoal(goalSheetForm, val)">{{entity + "Submit Goal" | translate}}</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <table class="table table-bordered" ng-show="goalSheetMap['empty']">
                    <tr>
                        <td class="col-md-12">
                            {{entity + 'No Goal sheet found for user.'|translate}}
                        </td>
                    </tr>
                </table>
            </form>

            <form ng-show="flag === 'show_verify'" name="verifyForm" id="verifyForm">
                <div class="row">
                    <div class="col-md-12"> 
                        <div class="col-md-3">
                            <h4>{{entity + "Verify Goal Sheet" | translate}}</h4>
                        </div>
                        <div class="col-md-9 pull-right text-right">
                            <button class="btn btn-hkg pull-right" ng-click="backLink()"><span class="glyphicon glyphicon-arrow-left"></span>&nbsp;Back</button>
                        </div>
                    </div>
                </div>
                <div class="row" ng-if="canAccess('goalsheetAccess')">
                    <br/>
                    <div class="col-md-6 pull-left">
                        <div class="col-md-4"><span>{{entity + "Verify goal sheet of " | translate}}</span></div>
                        <div class="col-md-2" style="padding-left: 20px">
                            <label><input type="radio" name="goalSheetType1" ng-change="radioChange()" id="goalSheetType12" ng-model="flag1.typeOfUserVerify" value="myGoalSheet"/>{{entity + " mine" | translate}}</label>
                        </div>
                        <div class="col-md-5">
                            <input class="col-md-1" type="radio" name="goalSheetType1" id="goalSheetType13" ng-model="flag1.typeOfUserVerify" value="otherGoalSheet"/>
                            <select ng-disabled="flag1.typeOfUserVerify === 'myGoalSheet'" class="col-md-11 hkg-nopadding input-sm" ui-select2="{allowClear:true}" ng-model="flag1.userIdVerify" id="selectUser1" name="selectUser1" data-placeholder="{{ entity + 'Select user' | translate}}">
                                <option value=""></option>
                                <option ng-repeat="user in userList" value="{{user.otherId}}" title="{{user.label}}">{{user.label.length > 41 ? user.label.substring(0, 41) + '...' : user.label}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12">&nbsp;</div>
                </div>
                <div class='form-group'>
                    <label for="fromDate"  class="col-md-2 control-label ">
                        <span style="color: red">*</span>{{ entity + 'From Date' | translate}}
                    </label>
                    <div class="col-md-6">
                        <div class="row">
                            <div class='col-md-5'>
                                <div ng-class="{'has-error': verifyForm.fromDate.$invalid && (verifyForm.fromDate.$dirty || submitted)}"> 
                                    <div class="input-group">
                                        <input type="text" id="fromDate" name="fromDate" class="form-control input-sm" placeholder="{{format}}" datepicker-popup="{{format}}" ng-model="verfiyData.fromDate" is-open="datePicker.opened_event_from_date" max="verfiyData.toDate" datepicker-options="dateOptions" date-disabled="disabled(date, mode)" ng-required="true"  close-text="Close"/>
                                        <span class="input-group-btn">
                                            <button class="form-control input-sm" ng-click="open($event, 'opened_event_from_date');">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </button>
                                        </span> 
                                    </div>
                                    <div class="error,help-block" ng-show="(verifyForm.fromDate.$dirty || submitted) && verifyForm.fromDate.$invalid">
                                        <span class="help-block" ng-show="verifyForm.fromDate.$error.required && !(verifyForm.fromDate.$error.date || verifyForm.fromDate.$error.min || verifyForm.fromDate.$error.max)">
                                                        {{ entity + "From date not entered" | translate }}</span>
                                        <span class="help-block" ng-show="verifyForm.fromDate.$error.date">{{ entity + "Invalid date format" | translate }}</span>
                                        <span class="help-block" ng-show="verifyForm.fromDate.$error.min">{{ entity + "Violates minimum constraint" | translate }}</span>
                                        <span class="help-block" ng-show="verifyForm.fromDate.$error.max">{{ entity + "Violates maximum constraint" | translate }}</span>
                                    </div>
                                </div>
                            </div>
                            <label for="toDate"  class="col-md-2 control-label">
                                {{ entity + 'To' | translate}}
                            </label>
                            <div class='col-md-5' ng-class="{'has-error': verifyForm.toDate.$invalid}">
                                <div class="input-group">
                                    <input type="text" id="toDate" name="toDate" class="form-control input-sm" placeholder="{{format}}" datepicker-popup="{{format}}" ng-model="verfiyData.toDate" is-open="datePicker.opened_event_to_date"  min="verfiyData.fromDate===undefined?minEventFromDate:verfiyData.fromDate" datepicker-options="dateOptions" date-disabled="disabled(date, mode)" close-text="Close"/>
                                    <span class="input-group-btn">
                                        <button class="form-control input-sm" ng-click="open($event, 'opened_event_to_date');">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </button>
                                    </span>
                                </div>
                                <div class="error,help-block" ng-show="verifyForm.toDate.$invalid">
                                    <span class="help-block" ng-show="verifyForm.toDate.$error.date">{{ entity + "Invalid date format" | translate }}</span>
                                    <span class="help-block" ng-show="verifyForm.toDate.$error.min">{{ entity + "Violates minimum constraint" | translate }}</span>
                                    <span class="help-block" ng-show="verifyForm.toDate.$error.max">{{ entity + "Violates maximum constraint" | translate }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="row">
                        <hr/>
                        <div class="col-xs-12 pull-right text-right"> 
                            <a href="" ng-click="cancelVerify()">
                                {{ entity + 'Cancel' | translate}}
                            </a>&nbsp;
                            <button class="btn btn-hkg" ng-click="searchInGoalSheet()">
                                <span ng-bind="entity + 'Search' | translate"></span>
                            </button>
                        </div>
                    </div>

                    <div class="row" ng-show="!verifyGoalSheetMap['empty']" ng-repeat="(key, value) in verifyGoalSheetMap" >
                        <div class="col-md-3">{{entity + "For: "+key | translate}}</div>
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th class="text text-center col-md-3">{{entity + "Goal" | translate}}</th>
                                    <th class="text text-center col-md-3">{{entity + "Submit By" | translate}}</th>
                                    <th ng-if="flag1.userIdVerify!=-1" class="text text-center col-md-3">{{entity + "Realized count" | translate}}</th>
                                    <th class="text text-center col-md-3">{{entity + "Status" | translate}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="val in value| orderBy:'toDate':true" ng-form="verifyGoalSheetForm">
                                    <td class="text text-center col-md-3">{{entity + val.goalName | translate}}</td>
                                    <td class="text text-center col-md-3">{{entity + val.toDate | translate | date}}</td>
                                    <td ng-if="flag1.userIdVerify!=-1" class="text text-center col-md-3">{{entity + val.realizedCount | translate}}</td>
                                    <td class="text text-center col-md-3">{{entity + val.goalAchieved?"Achieved":"Not achieved" | translate}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br/>
                    <div class="row" ng-show="verifyGoalSheetMap['empty'] && submitted && verifyForm.$valid">
                        <table class="table table-bordered" >
                            <tr>
                                <td class="col-md-12">
                                    {{entity + 'No Goal sheet found for user.'|translate}}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>