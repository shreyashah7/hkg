define(["hkg","locationService"],function(a,b){a.register.controller("LocationController",["$rootScope","$scope","LocationService","$filter",function(c,d,e,f){c.maskLoading();
c.mainMenu="manageLink";
c.childMenu="manageLocation";
c.activateMenu();
d.entity="LOCATIONS.";
d.defaultButtons=true;
d.activate=false;
d.activeChildren=false;
d.parentActived=true;
e.retriveAllLocations({active:"false"},function(g){d.locationMap=g.locationMap;
d.countryList=g.countryList;
d.addLocationForm.$dirty=false;
if(d.editLocationForm!==undefined){d.editLocationForm.$dirty=false
}},function(){var h="Fail to load Location Master";
var g=c.failure;
c.addMessage(h,g)
});
d.initAddLocationForm=function(g){d.addLocationForm=g
};
d.initEditLocationForm=function(g){d.editLocationForm=g
};
d.retrieveLocations=function(g){d.districtHierarchy=false;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.cityHierarchy=false;
e.retriveAllLocations({active:g},function(h){d.locationMap=h.locationMap;
d.countryList=h.countryList;
d.retriveLocationstree("true");
d.addLocations=true
},function(){var i="Fail to load location master";
var h=c.failure;
c.addMessage(i,h)
})
};
d.retriveLocationstree=function(g){e.retriveLocationstree({key:g},function(k){d.locationTree=k;
d.locationTree=f("orderBy")(d.locationTree,"locationName");
d.treeToListJson=[];
function h(n){if(n!==undefined&&n!==null){var m=n;
if(m.id!==undefined&&m.id!==null){d.treeToListJson.push({key:m.id,isActive:m.isActive,parent:m.parentId})
}if(m.children!==undefined&&m.children!==null){for(var l=0;
l<m.children.length>0;
l++){h(m.children[l])
}}}}d.tree=angular.copy(k);
for(var j=0;
j<d.tree.length;
j++){h(d.tree[j])
}},function(){var i="Fail to load location tree";
var h=c.failure;
c.addMessage(i,h)
})
};
d.addTheLocation=function(){if(angular.isDefined(d.editLocationForm)){d.editLocationForm.$setPristine()
}d.activeChildren=false;
d.parentActived=true;
d.addLocationForm.$dirty=false;
d.defaultButtons=true;
$("#scrollable-dropdown-menu.typeahead").typeahead("val","");
d.displaySearchedLocation="";
d.submitted=false;
d.addCountry=false;
d.districtHierarchy=false;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.cityHierarchy=false;
d.selectHierarchy=null;
d.addLocations=true;
d.editlocations=false;
d.managelocations=false;
if(d.locationval!=undefined){d.locationval.selected=undefined
}if(d.locationval!=undefined&&d.locationval.currentNode){d.locationval.currentNode.selected=undefined;
d.locationval.currentNode=undefined
}d.clear();
d.selected=null
};
d.updateTheLocation=function(){d.submitted=false;
d.districtHierarchy=false;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.cityHierarchy=false;
d.selectHierarchy=null;
d.managelocations=false;
d.editlocations=false;
d.addLocations=true;
d.clear();
d.selected=null
};
d.hierarchies=["Country","State","District","City"];
d.$watch("selectHierarchy",function(){d.showHierarchy=d.selectHierarchy;
d.defaultButtons=false;
if(d.showHierarchy==="Country"){d.addCountry=true;
d.addState=false;
d.addDistrict=false;
d.addCity=false;
d.clear();
d.selected=null;
d.updateCountry=true
}else{if(d.showHierarchy==="State"){d.updateCountry=true;
d.addCountry=false;
d.addState=true;
d.addDistrict=false;
d.addCity=false;
d.clear();
d.selected=null
}else{if(d.showHierarchy==="District"){d.updateCountry=true;
d.addCountry=false;
d.addDistrict=true;
d.addState=false;
d.addCity=false;
d.clear();
d.selected=null
}else{if(d.showHierarchy==="City"){d.updateCountry=true;
d.addCountry=false;
d.addState=false;
d.addDistrict=false;
d.addCity=true;
d.clear();
d.selected=null
}else{d.country=null;
d.defaultButtons=true;
d.updateCountry=false;
d.addCountry=false;
d.addState=false;
d.addDistrict=false;
d.addCity=false;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.districtHierarchy=false;
d.cityHierarchy=false
}}}}});
d.$watch("activate",function(g){if(d.activate===true){d.retrieveLocations("true");
d.clear()
}else{d.retrieveLocations("false");
d.clear()
}});
d.status=[{id:true,name:"Active"},{id:false,name:"InActive"}];
d.getChildsUpdate=function(g,h){d.selectedValue=[];
if(g===null||typeof(g)==="undefined"||g==="Select"){if(h==="S"){d.state=null;
d.district=null;
d.city=null;
d.stateByCountry=[];
d.districtByState=[];
d.cityByDistrict=[]
}else{if(h==="D"){d.district=null;
d.city=null;
d.districtByState=[];
d.cityByDistrict=[]
}else{if(h==="T"){d.city=null;
d.cityByDistrict=[]
}}}d.showTable=false
}else{if((d.selectHierarchy==="Country"&&h==="S")||(d.selectHierarchy==="State"&&h==="D")||(d.selectHierarchy==="District"&&h==="T")||(d.selectHierarchy==="City"&&h==="C")){d.selectedValue=angular.copy(g);
d.showTable=true
}else{d.showTable=false
}d.getChilds(g.value,h)
}};
d.getChilds=function(g,h){if(g===null||typeof(g)==="undefined"){if(h==="S"){d.stateId=null;
d.districtId=null;
d.cityId=null;
d.stateByCountry=[];
d.districtByState=[];
d.cityByDistrict=[]
}else{if(h==="D"){d.districtId=null;
d.cityId=null;
d.districtByState=[];
d.cityByDistrict=[]
}else{if(h==="T"){d.cityByDistrict=[];
d.cityId=null
}}}}else{if(h==="S"){d.stateByCountry=d.locationMap[g]
}else{if(h==="D"){d.districtByState=d.locationMap[g]
}else{if(h==="T"){d.cityByDistrict=d.locationMap[g]
}}}}if(d.selected==="Select"){d.showTable=false
}};
d.setPristine=function(){d.submitted=false;
d.addLocationForm.$setPristine()
};
d.createLocation=function(g){d.submitted=true;
if(d.addLocationForm.$valid){d.districtHierarchy=false;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.cityHierarchy=false;
var h={};
if(g!=null){h.locationName=g.locationName;
if(d.selectHierarchy==="Country"){h.locationType="Country"
}if(d.selectHierarchy==="State"){h.id=d.countryId;
h.locationType="State"
}if(d.selectHierarchy==="District"){h.id=d.stateId;
h.locationType="District"
}if(d.selectHierarchy==="City"){h.id=d.districtId;
h.locationType="City"
}}var j=function(){var l="Failed to create system feature";
var k=c.failure;
c.addMessage(l,k)
};
var i=function(k){d.retrieveLocations("false");
h.id=null;
h.locationName=null;
d.clear();
d.managelocations=false;
d.addLocations=true;
d.editlocations=false;
d.updateCountry=false;
d.addCountry=false;
d.addState=false;
d.addDistrict=false;
d.addCity=false;
d.selectHierarchy=false
};
e.saveAllLocations(h,i,j);
d.submitted=false;
d.addLocationForm.$dirty=false
}};
d.newLocation={};
d.treeEditLocation=function(g){if(angular.isDefined(d.addLocationForm)){d.addLocationForm.$setPristine()
}$("#scrollable-dropdown-menu.typeahead").typeahead("val","");
d.displaySearchedLocation="";
d.submitted=false;
d.managelocations=false;
d.addLocations=false;
d.editlocations=true;
if(g.currentNode!==""&&g.currentNode!==undefined){if(g.currentNode.locationType==="country"){d.countryHierarchy=true;
d.stateHierarchy=false;
d.districtHierarchy=false;
d.cityHierarchy=false;
d.newLocation=angular.copy(g)
}else{if(g.currentNode.locationType==="states"){d.countryHierarchy=false;
d.stateHierarchy=true;
d.districtHierarchy=false;
d.cityHierarchy=false;
d.newLocation=angular.copy(g)
}else{if(g.currentNode.locationType==="district"){d.districtHierarchy=true;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.cityHierarchy=false;
d.newLocation=angular.copy(g)
}else{if(g.currentNode.locationType==="city"){d.cityHierarchy=true;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.districtHierarchy=false;
d.newLocation=angular.copy(g)
}}}}}else{if(g.locationType==="country"){d.countryHierarchy=true;
d.stateHierarchy=false;
d.districtHierarchy=false;
d.cityHierarchy=false;
d.newLocation.currentNode=angular.copy(g)
}else{if(g.locationType==="states"){d.countryHierarchy=false;
d.stateHierarchy=true;
d.districtHierarchy=false;
d.cityHierarchy=false;
d.newLocation.currentNode=angular.copy(g)
}else{if(g.locationType==="district"){d.districtHierarchy=true;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.cityHierarchy=false;
d.newLocation.currentNode=angular.copy(g)
}else{if(g.locationType==="city"){d.cityHierarchy=true;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.districtHierarchy=false;
d.newLocation.currentNode=angular.copy(g)
}}}}}};
d.editLoc=function(k){d.submitted=true;
if(d.editLocationForm.$valid){d.activeChildren=false;
d.parentActived=true;
var m=false;
var l=function(r){if(!d.activeChildren&&r!==undefined&&r!==null){for(var p=0;
p<r.length;
p++){var q=r[p];
if(!d.activeChildren&&q.isActive){d.activeChildren=true;
m=true;
break
}if(!d.activeChildren&&q.children&&q.children!==null){l(q.children)
}else{m=true
}}}else{m=true
}};
var g=k.currentNode.children;
if(!k.currentNode.isActive){l(g)
}if(k.currentNode.isActive){var j=function(q){if(q!==undefined&&q!==null&&d.treeToListJson!==undefined&&d.treeToListJson!==null){for(var p=0;
p<d.treeToListJson.length;
p++){if(q===d.treeToListJson[p].key&&!d.treeToListJson[p].isActive){d.parentActived=false
}if(d.parentActived&&d.treeToListJson[p].parentId!==undefined&&d.treeToListJson[p].parentId!==null){j(d.treeToListJson[p].parentId)
}else{m=true
}}}else{m=true
}};
var n=k.currentNode.parentId;
j(n)
}if(d.activeChildren&&m){$("#overridePopUp").modal("show")
}if(!d.parentActived&&m){$("#overridePopUp").modal("show")
}if((k.currentNode.isActive&&d.parentActived&&m)||(!d.activeChildren&&m&&!k.currentNode.isActive)){var o={id:k.currentNode.id,locationName:k.currentNode.locationName,isActive:k.currentNode.isActive,parentId:k.currentNode.parentId,children:k.currentNode.children};
var h=function(){var q="Failed to create system feature";
var p=c.failure;
c.addMessage(q,p)
};
var i=function(q){var p=d.activate.toString();
d.retrieveLocations(p);
d.clear();
d.managelocations=false;
d.addLocations=true;
d.editlocations=false;
d.updateCountry=false;
d.addCountry=false;
d.addState=false;
d.addDistrict=false;
d.addCity=false;
d.selectHierarchy=false
};
e.updateLocations(o,i,h);
d.submitted=false
}else{}}};
d.updateLocation=function(j){d.submitted=true;
if(d.manageLocationsForm.$valid){var k;
if(d.selectHierarchy==="Country"){k=null
}if(d.selectHierarchy==="State"){k=d.country.value
}if(d.selectHierarchy==="District"){k=d.state.value
}if(d.selectHierarchy==="City"){k=d.district.value
}var g={id:j.value,locationName:j.label,isActive:j.isActive,parentId:k};
var i=function(){var m="Failed to create system feature";
var l=c.failure;
c.addMessage(m,l)
};
var h=function(m){var l=d.activate.toString();
d.retrieveLocations(l);
d.managelocations=false;
d.addLocations=true;
d.editlocations=false;
d.clear()
};
e.updateLocations(g,h,i);
d.submitted=false
}};
d.cancelAddLocForm=function(){d.activeChildren=false;
d.parentActived=true;
d.defaultButtons=true;
d.location={};
d.setPristine();
$("#scrollable-dropdown-menu.typeahead").typeahead("val","");
d.clear();
d.managelocations=false;
d.addLocations=true;
d.editlocations=false;
d.selectHierarchy=null;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.districtHierarchy=false;
d.cityHierarchy=false;
d.addCountry=false;
d.addState=false;
d.addDistrict=false;
d.addCity=false;
if(d.locationval!=undefined){d.locationval.selected=undefined
}if(d.locationval!=undefined&&d.locationval.currentNode){d.locationval.currentNode.selected=undefined;
d.locationval.currentNode=undefined
}if(angular.isDefined(d.addLocationForm)){d.addLocationForm.$setPristine()
}if(angular.isDefined(d.editLocationForm)){d.editLocationForm.$setPristine()
}};
d.clear=function(){d.showTable=false;
d.district=null;
d.state=null;
d.country=null;
d.city=null;
d.countryId=null;
d.stateId=null;
d.districtId=null;
d.cityId=null;
d.selected=null;
d.stateByCountry=[];
d.location=null;
d.cityByDistrict=[];
d.districtByState=[]
};
d.editSearchedLoc=function(i){d.submitted=false;
d.managelocations=false;
d.addLocations=false;
d.editlocations=true;
d.districtHierarchy=false;
d.countryHierarchy=false;
d.stateHierarchy=false;
d.cityHierarchy=false;
var g=false;
var h={};
angular.forEach(d.countryList,function(j){if(j.value===i){g=true;
h.id=j.value;
h.locationType="country";
h.parentId=null;
h.isActive=j.isActive;
h.locationName=j.label;
d.countryHierarchy=true
}});
if(!g){angular.forEach(d.locationMap,function(k,j){if(!g){angular.forEach(k,function(l){if(l.value==i){h.id=l.value;
h.parentId=j;
h.isActive=l.isActive;
h.locationName=l.label;
if(l.description==="S"){d.stateHierarchy=true
}else{if(l.description==="D"){d.districtHierarchy=true
}else{if(l.description==="T"){d.cityHierarchy=true
}}}}})
}})
}d.newLocation={};
d.newLocation.currentNode=angular.copy(h);
d.displaySearchedLocation=""
};
d.hidePopUp=function(){$("#overridePopUp").modal("hide");
c.removeModalOpenCssAfterModalHide()
};
c.unMaskLoading()
}])
});