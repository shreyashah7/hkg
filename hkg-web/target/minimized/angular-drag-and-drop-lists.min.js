angular.module("dndLists",[]).directive("dndDraggable",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(c,a,d,b){return function(e,f,g){f.attr("draggable","true");
if(g.dndDisableIf){e.$watch(g.dndDisableIf,function(h){f.attr("draggable",!h)
})
}f.on("dragstart",function(h){h=h.originalEvent||h;
h.dataTransfer.setData("Text",angular.toJson(e.$eval(g.dndDraggable)));
h.dataTransfer.effectAllowed=g.dndEffectAllowed||"move";
f.addClass("dndDragging");
a(function(){f.addClass("dndDraggingSource")
},0);
d.dropEffect="none";
b.isDragging=true;
b.dragType=g.dndType?e.$eval(g.dndType):undefined;
c(g.dndDragstart)(e,{event:h});
h.stopPropagation()
});
f.on("dragend",function(i){i=i.originalEvent||i;
var h=d.dropEffect;
e.$apply(function(){switch(h){case"move":c(g.dndMoved)(e,{event:i});
break;
case"copy":c(g.dndCopied)(e,{event:i});
break
}});
f.removeClass("dndDragging");
f.removeClass("dndDraggingSource");
b.isDragging=false;
i.stopPropagation()
});
f.on("click",function(h){h=h.originalEvent||h;
e.$apply(function(){c(g.dndSelected)(e,{event:h})
});
h.stopPropagation()
});
f.on("selectstart",function(){if(this.dragDrop){this.dragDrop()
}return false
})
}
}]).directive("dndList",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(c,a,d,b){return function(q,C,j){function r(m,g,o){var l=n?m.offsetX||m.layerX:m.offsetY||m.layerY;
var f=n?g.offsetWidth:g.offsetHeight;
var h=n?g.offsetLeft:g.offsetTop;
h=o?h:0;
return l<h+f/2
}function e(){return Array.prototype.indexOf.call(w.children,z)
}function x(g){if(!b.isDragging&&!y){return false
}if(!t(g.dataTransfer.types)){return false
}if(j.dndAllowedTypes&&b.isDragging){var f=q.$eval(j.dndAllowedTypes);
if(angular.isArray(f)&&f.indexOf(b.dragType)===-1){return false
}}if(j.dndDisableIf&&q.$eval(j.dndDisableIf)){return false
}return true
}function A(){B.remove();
C.removeClass("dndDragover");
return true
}function k(f,h,g){return c(f)(q,{event:h,index:e(),item:g||undefined,external:!b.isDragging,type:b.isDragging?b.dragType:undefined})
}function t(g){if(!g){return true
}for(var f=0;
f<g.length;
f++){if(g[f]==="Text"||g[f]==="text/plain"){return true
}}return false
}var B=angular.element("<li class='dndPlaceholder'></li>");
var z=B[0];
var w=C[0];
var n=j.dndHorizontalList&&q.$eval(j.dndHorizontalList);
var y=j.dndExternalSources&&q.$eval(j.dndExternalSources);
C.on("dragover",function(g){g=g.originalEvent||g;
if(!x(g)){return true
}if(z.parentNode!=w){C.append(B)
}if(g.target!==w){var f=g.target;
while(f.parentNode!==w&&f.parentNode){f=f.parentNode
}if(f.parentNode===w&&f!==z){if(r(g,f)){w.insertBefore(z,f)
}else{w.insertBefore(z,f.nextSibling)
}}}else{if(r(g,z,true)){while(z.previousElementSibling&&(r(g,z.previousElementSibling,true)||z.previousElementSibling.offsetHeight===0)){w.insertBefore(z,z.previousElementSibling)
}}else{while(z.nextElementSibling&&!r(g,z.nextElementSibling,true)){w.insertBefore(z,z.nextElementSibling.nextElementSibling)
}}}if(j.dndDragover&&!k(j.dndDragover,g)){return A()
}C.addClass("dndDragover");
g.preventDefault();
g.stopPropagation();
return false
});
C.on("drop",function(l){l=l.originalEvent||l;
if(!x(l)){return true
}l.preventDefault();
var g=l.dataTransfer.getData("Text")||l.dataTransfer.getData("text/plain");
var i;
try{i=JSON.parse(g)
}catch(h){return A()
}if(j.dndDrop){i=k(j.dndDrop,l,i);
if(!i){return A()
}}var f=q.$eval(j.dndList);
q.$apply(function(){f.splice(e(),0,i)
});
if(l.dataTransfer.dropEffect==="none"){if(l.dataTransfer.effectAllowed==="copy"||l.dataTransfer.effectAllowed==="move"){d.dropEffect=l.dataTransfer.effectAllowed
}else{d.dropEffect=l.ctrlKey?"copy":"move"
}}else{d.dropEffect=l.dataTransfer.dropEffect
}A();
l.stopPropagation();
return false
});
C.on("dragleave",function(f){f=f.originalEvent||f;
C.removeClass("dndDragover");
a(function(){if(!C.hasClass("dndDragover")){B.remove()
}},100)
})
}
}]).factory("dndDragTypeWorkaround",function(){return{}
}).factory("dndDropEffectWorkaround",function(){return{}
});